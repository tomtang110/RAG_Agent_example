<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simple Agent RAG for Basketball Player Information</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 40px;
      line-height: 1.8;
      color: #333;
      background-color: #f9f9f9;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid #007acc;
      padding-bottom: 15px;
    }
    .lang-switch {
      position: absolute;
      top: 20px;
      right: 20px;
    }
    button {
      background-color: #007acc;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 0 5px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #005a99;
    }
    .content {
      margin-top: 20px;
    }
    .zh, .en {
      display: none;
    }
    .zh.active, .en.active {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }
    h1, h2, h3 {
      color: #2c3e50;
    }
    h1 {
      font-size: 2.2em;
      margin-bottom: 10px;
    }
    h2 {
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
      margin-top: 30px;
      color: #007acc;
    }
    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      color: #d63384;
    }
    pre {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      border: 1px solid #e9ecef;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 12px;
      text-align: left;
    }
    th {
      background-color: #007acc;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    .note {
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
      font-style: italic;
    }
    .future {
      background-color: #d1ecf1;
      border-left: 4px solid #17a2b8;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    .footer {
      margin-top: 50px;
      text-align: center;
      font-size: 14px;
      color: #6c757d;
      border-top: 1px solid #eee;
      padding-top: 20px;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .logo {
      color: #007acc;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="lang-switch">
        <button onclick="setLang('zh')">中文</button>
        <button onclick="setLang('en')">English</button>
      </div>
      <h1><span class="logo">🏀 Agent RAG</span> - 篮球运动员信息问答系统</h1>
      <p>A Simple RAG System for Basketball Player Information</p>
    </div>

    <div class="content">
      <!-- 中文内容 -->
      <div id="zh" class="zh active">
        <h2>项目简介</h2>
        <p>本项目实现了一个简单的 <strong>Agent RAG（检索增强生成）系统</strong>，旨在帮助开发者和研究者理解如何构建一个领域专用的问答系统。当前系统专注于 <strong>篮球相关问题</strong>，数据涵盖 <strong>中国和美国各前50名篮球运动员的概览信息</strong>。</p>
        <p>系统集成了路由、嵌入检索（Embedding）、BM25、生成等核心模块，是学习 RAG 架构的理想实践项目。</p>

        <h2>📚 数据集说明</h2>
        <p>系统基于以下两个 Excel 数据文件构建：</p>
        <ul>
          <li><code>america_basketball_player.xlsx</code>：美国前50名篮球运动员的综合信息</li>
          <li><code>china_basketball_player.xlsx</code>：中国前50名篮球运动员的综合信息</li>
        </ul>
        <div class="note">
          ⚠️ <strong>注意</strong>：本系统<strong>仅支持篮球相关查询</strong>，其他领域问题将被拒绝。
        </div>

        <h2>🧱 系统架构</h2>
        <p>Agent RAG 流程包含以下核心组件：</p>
        <table>
          <tr>
            <th>模块</th>
            <th>功能说明</th>
          </tr>
          <tr>
            <td><strong>Router（路由）</strong></td>
            <td>判断用户问题是否与篮球相关，过滤无关请求</td>
          </tr>
          <tr>
            <td><strong>Retriever（检索器）</strong></td>
            <td>融合 <strong>向量检索（Embedding）</strong> 与 <strong>关键词检索（BM25）</strong>，提升召回准确率</td>
          </tr>
          <tr>
            <td><strong>Generator（生成器）</strong></td>
            <td>基于检索结果，调用大模型生成自然语言回答</td>
          </tr>
        </table>
        <div class="future">
          🔧 <strong>后续计划</strong>：将逐步加入查询改写、重排序（reranker）、网络搜索等高级模块。
        </div>

        <h2>🛠️ 依赖库</h2>
        <p>项目依赖以下核心库和服务：</p>
        <ul>
          <li><code>qwen</code> – 使用通义千问 API 进行文本嵌入和生成</li>
          <li><code>langchain</code> – 构建 LLM 应用的核心框架</li>
          <li><code>langgraph</code> – 用于构建 Agent 状态流和工作流</li>
          <li><code>pydantic</code> – 数据校验与配置管理</li>
          <li><code>pandas</code> – 读取和处理 Excel 数据</li>
          <li><code>openpyxl</code> – 支持 <code>.xlsx</code> 文件读取</li>
          <li>其他常用库：<code>tqdm</code>, <code>numpy</code> 等</li>
        </ul>
        <p>安装依赖：</p>
        <pre><code>pip install -r requirements.txt</code></pre>
        <div class="note">
          💡 需提前配置 <strong>Qwen API Key</strong>（建议通过环境变量设置）
        </div>

        <h2>📁 项目结构</h2>
        <pre>
.
├── main.py                   # 主程序入口：实现完整的 RAG 流程
├── models.py                 # 定义嵌入模型和生成模型的 API 接口
├── prompt_set.py             # 包含路由和生成阶段的提示词模板
├── utils.py                  # 工具函数，如数据解析、格式处理等
├── america_basketball_player.xlsx  # 美国球员数据集
├── china_basketball_player.xlsx    # 中国球员数据集
├── README.md / README_zh.md  # 说明文档（中英文）
└── requirements.txt          # 依赖列表
        </pre>

        <h2>🚀 使用方法</h2>
        <ol>
          <li><strong>设置 Qwen API Key</strong>：
            <pre><code>export QWEN_API_KEY="your_api_key_here"</code></pre>
          </li>
          <li><strong>运行主程序</strong>：
            <pre><code>python main.py</code></pre>
          </li>
          <li><strong>输入问题示例</strong>：
            <ul>
              <li>“中国排名前三的球员是谁？”</li>
              <li>“勒布朗·詹姆斯效力于哪支球队？”</li>
              <li>“姚明的身高和职业生涯得分是多少？”</li>
            </ul>
          </li>
        </ol>
        <div class="note">
          ✅ 系统会自动判断问题相关性，非篮球问题将被礼貌拒绝。
        </div>

        <h2>🧪 示例输出</h2>
        <p><strong>输入</strong>：
        “列出中国前3名球员的职业生涯总得分”</p>
        <p><strong>输出</strong>：
        根据数据，中国前3名球员的职业生涯得分如下：<br>
        1. 姚明 – NBA与CBA合计超过9200分<br>
        2. 易建联 – 职业生涯累计7500+分<br>
        3. 郭艾伦 – CBA核心后卫，得分超6000分</p>
        <div class="note">
          （注：具体数值以实际数据集内容为准）
        </div>

        <h2>📌 当前限制</h2>
        <ul>
          <li>仅支持篮球领域问题</li>
          <li>暂无查询扩展、重排序等高级功能</li>
          <li>回答质量依赖数据完整性和模型能力</li>
        </ul>

        <h2>🌟 后续优化计划</h2>
        <div class="future">
          <ul>
            <li>[ ] 添加 <strong>查询改写（Query Rewriting）</strong> 提升召回率</li>
            <li>[ ] 集成 <strong>重排序模型（Reranker）</strong> 提高结果相关性</li>
            <li>[ ] 支持 <strong>网络搜索扩展</strong>，应对未知知识</li>
            <li>[ ] 扩展至更多体育项目或通用领域</li>
          </ul>
        </div>

        <h2>🙌 致谢</h2>
        <ul>
          <li><a href="https://langchain.com" target="_blank">LangChain</a> 与 <a href="https://langchain-ai.github.io/langgraph/" target="_blank">LangGraph</a> – 强大的流程编排工具</li>
          <li><a href="https://qwen.ai" target="_blank">通义千问 Qwen</a> – 提供高质量的 LLM API 支持</li>
        </ul>

        <h2>📄 许可证</h2>
        <p>MIT License，详见 <code>LICENSE</code> 文件。</p>
      </div>

      <!-- 英文内容 -->
      <div id="en" class="en">
        <h2>Project Overview</h2>
        <p>This repository provides a simple <strong>Agent RAG (Retrieval-Augmented Generation)</strong> system designed to help practitioners understand the foundational components of building a domain-specific question-answering system. The current implementation focuses exclusively on <strong>basketball-related queries</strong>, specifically information about the <strong>top 50 Chinese and American basketball players</strong>.</p>
        <p>This project is ideal for learning how to integrate core RAG components such as routing, retrieval (embedding + BM25), and generation using modern LLM tooling.</p>

        <h2>📚 Dataset Overview</h2>
        <p>The system is trained on two datasets:</p>
        <ul>
          <li><code>america_basketball_player.xlsx</code>: Overview of the top 50 American basketball players</li>
          <li><code>china_basketball_player.xlsx</code>: Overview of the top 50 Chinese basketball players</li>
        </ul>
        <div class="note">
          ⚠️ <strong>Note</strong>: The RAG system currently <strong>only supports basketball-related queries</strong> due to the limited scope of the dataset.
        </div>

        <h2>🧱 System Architecture</h2>
        <p>The Agent RAG pipeline includes the following core modules:</p>
        <table>
          <tr>
            <th>Module</th>
            <th>Description</th>
          </tr>
          <tr>
            <td><strong>Router</strong></td>
            <td>Determines if the query is basketball-related. If not, it returns a rejection response.</td>
          </tr>
          <tr>
            <td><strong>Retriever</strong></td>
            <td>Combines <strong>dense retrieval (embedding-based)</strong> and <strong>sparse retrieval (BM25)</strong> for robust document lookup.</td>
          </tr>
          <tr>
            <td><strong>Generator</strong></td>
            <td>Uses a large language model to generate natural language responses based on retrieved context.</td>
          </tr>
        </table>
        <div class="future">
          🔧 <strong>Future Enhancements</strong>: Support for query rewriting, reranking, and web search will be added in upcoming versions.
        </div>

        <h2>🛠️ Dependencies</h2>
        <p>This project relies on the following key libraries and services:</p>
        <ul>
          <li><code>qwen</code> – Alibaba's Qwen API for LLM inference (used for generation and embeddings)</li>
          <li><code>langchain</code> – Framework for building LLM-powered applications</li>
          <li><code>langgraph</code> – For orchestrating agent workflows and state management</li>
          <li><code>pydantic</code> – Data validation and settings management</li>
          <li><code>pandas</code> – For loading and processing Excel datasets</li>
          <li><code>openpyxl</code> – Required for reading <code>.xlsx</code> files</li>
          <li>Other standard utilities: <code>tqdm</code>, <code>numpy</code>, etc.</li>
        </ul>
        <p>Install dependencies:</p>
        <pre><code>pip install -r requirements.txt</code></pre>
        <div class="note">
          💡 You must have access to the <strong>Qwen API</strong> and configure your API key (e.g., via environment variables).
        </div>

        <h2>📁 Project Structure</h2>
        <pre>
.
├── main.py                   # Entry point: Implements the full RAG pipeline
├── models.py                 # Defines the embedding and generation APIs using Qwen
├── prompt_set.py             # Contains prompts for router and generator
├── utils.py                  # Utility functions for parsing and data processing
├── america_basketball_player.xlsx  # Dataset: Top 50 American players
├── china_basketball_player.xlsx    # Dataset: Top 50 Chinese players
├── README.md / README_zh.md  # This file
└── requirements.txt          # Python dependencies
        </pre>

        <h2>🚀 Usage</h2>
        <ol>
          <li><strong>Set up your Qwen API key</strong>:
            <pre><code>export QWEN_API_KEY="your_api_key_here"</code></pre>
          </li>
          <li><strong>Run the main application</strong>:
            <pre><code>python main.py</code></pre>
          </li>
          <li><strong>Ask a question</strong>:
            <ul>
              <li>"Who is the tallest player in the Chinese top 50?"</li>
              <li>"What team does the number 1 ranked American player play for?"</li>
              <li>"What are Yao Ming's height and career points?"</li>
            </ul>
          </li>
        </ol>
        <div class="note">
          ✅ Only basketball-related questions will be processed. All others will be filtered by the router.
        </div>

        <h2>🧪 Example Output</h2>
        <p><strong>Input</strong>:
        "List the top 3 Chinese basketball players by career points."</p>
        <p><strong>Output</strong>:
        Based on the dataset, the top 3 Chinese basketball players by career points are:<br>
        1. Yao Ming – 9,200+ points in the NBA and CBA combined<br>
        2. Yi Jianlian – Over 7,500 professional points<br>
        3. Guo Ailun – Key guard with over 6,000 CBA points</p>
        <div class="note">
          *(Note: Actual stats depend on dataset content)*
        </div>

        <h2>📌 Limitations</h2>
        <ul>
          <li>Domain-specific: Only answers questions related to the provided basketball datasets.</li>
          <li>No query expansion or advanced reranking yet.</li>
          <li>Performance depends on the quality of the input data and embedding model.</li>
        </ul>

        <h2>🌟 Future Work</h2>
        <div class="future">
          <ul>
            <li>[ ] Add <strong>query revision</strong> module to improve retrieval accuracy</li>
            <li>[ ] Integrate a <strong>reranker</strong> (e.g., BERT-based) to improve result relevance</li>
            <li>[ ] Enable <strong>web search fallback</strong> for out-of-dataset queries</li>
            <li>[ ] Support for more sports and broader domains</li>
          </ul>
        </div>

        <h2>🙌 Acknowledgments</h2>
        <ul>
          <li><a href="https://langchain.com" target="_blank">LangChain</a> & <a href="https://langchain-ai.github.io/langgraph/" target="_blank">LangGraph</a> – For powerful orchestration tools</li>
          <li><a href="https://qwen.ai" target="_blank">Alibaba Cloud Qwen</a> – For providing state-of-the-art LLM APIs</li>
        </ul>

        <h2>📄 License</h2>
        <p>MIT License. See <code>LICENSE</code> for details.</p>
      </div>
    </div>

    <div class="footer">
      <p>🤖 Built with ❤️ by Qwen | Alibaba Cloud | For educational and research purposes only.</p>
    </div>
  </div>

  <script>
    function setLang(lang) {
      document.querySelectorAll('.zh, .en').forEach(el => el.classList.remove('active'));
      document.getElementById(lang).classList.add('active');
      // Optional: Save preference
      localStorage.setItem('preferred-lang', lang);
    }

    // Auto-detect language preference
    window.onload = function() {
      const savedLang = localStorage.getItem('preferred-lang');
      const userLang = navigator.language || navigator.userLanguage;
      if (savedLang) {
        setLang(savedLang);
      } else if (userLang.startsWith('zh')) {
        setLang('zh');
      } else {
        setLang('en');
      }
    }
  </script>
</body>
</html>